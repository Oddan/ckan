{# 
Renders a list of resources with icons and view links.

resources - A list of resources to render
pkg - A package object that the resources belong to.

Example:

  {% snippet "package/snippets/resources_list.html", pkg=pkg, resources=pkg.resources %}

#}



{# Need to fix the css for the resources list since we put them in a checkbox form.
  The reason why we do it here is that modifying the general css file will result in problems
  in other pages where the checkbox form is not present #}
<style>
  .resource-item .description {
    position: relative;
    left:78px;
  }

  .resource-item:hover {
    background:none
  }
</style>



<section id="dataset-resources" class="resources">
    <h3>{{ _('Data and Resources') }}</h3>
    <br>
    {% block resource_list %}
      {% if resources %}
        <ul class="{% block resource_list_class %}resource-list{% endblock %}">
          {% block resource_list_inner %}
            {% set can_edit = h.check_access('package_update', {'id':pkg.id }) %}
            <form action="/multiple_download" method="POST" onsubmit="return validate_form()">
  
              {% for resource in resources %}
                  <input type="checkbox" name="{{Â resource.name }}" value="{{ resource.url }}">{% snippet 'package/snippets/resource_item.html', pkg=pkg, res=resource, can_edit=can_edit %}<br>
              {% endfor %}
              
              <br>
              <input type="submit" value="Download resources">
            </form>
          {% endblock %}
        </ul>
      {% else %}
        {% if h.check_access('resource_create', {'package_id': pkg['id']}) %}
            {% trans url=h.url_for(controller='package', action='new_resource', id=pkg.name) %}
              <p class="empty">This dataset has no data, <a href="{{ url }}">why not add some?</a></p>
            {% endtrans %}
        {% else %}
            <p class="empty">{{ _('This dataset has no data') }}</p>
        {% endif %}
      {% endif %}
    {% endblock %}
</section>


{# This script gets called when the form to download resources is submitted.
  Checks that at least one resource has been selected before submitting the request,
  and raises a warning otherwise. #}
<script type="text/javascript">
  function validate_form(){
    var checkboxes = document.querySelectorAll('input[type="checkbox"]')
    var checkedOne = Array.prototype.slice.call(checkboxes).some(x => x.checked)
    if (checkedOne){
      return true
    }
    else {
      alert("Please select at least one resource to download.")
      return false
    }}
</script>
  