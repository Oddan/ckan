{% extends "edit_metadata.html" %} 

{% set resource_classes = h.resource_categories() %}
{% set title = g.cur_item['title'] or "" %}
{% set description = g.cur_item['description'] or None %}
{% set datatype = g.cur_item['datatype'] or None %}
{% set available_datatypes = g.extra['available_datatypes'] %}
{% set current_mapping = g.extra['current_mapping'] %}

{% set category = g.cur_item['category'] or None %}
{% if category  %}
  {% set category_id = category['code'] %}
{% endif %}

{% block styles %}
  {{ super() }}
  {% resource "cdsmetadata/category_metadata.js" %}
{% endblock %}


{% block dataformat_subheading %}
  <h2>Edit Category Metadata</h2>
  {# <h5><a href="{{h.url_for('cdsmetadata.dataformat_list')}}">Click here for full (noneditable) list</a></h5> #}
{% endblock %} 

{% block metadata_form_fields %}

  <div id='category_select_form'
       onclick="var ca = document.getElementsByClassName('cat_atts'); 
                for (var i = 0; i < ca.length; i++) {
                  ca[i].style.display='none';
                }
                document.getElementById(document.getElementById('field-category').value).style.display='block';">
    
  {{ form.select('category', id='field-category', label=_('Resource category'),
                 options=resource_classes, 
                 selected=category_id or resource_classes[0].value,
                 error=errors.category,
                 classes='control-large')
  }}
  </div>

  {% for c in current_mapping %}
    <div id={{c}} class='cat_atts' style='display: none;'>
      {% if current_mapping[c] %}
        <p> Currently defined attributes for category {{c}} are: </p>

        <table class="table table-striped table-bordered table-condensed">
          <thead>
          </thead>
          <tr>
            <th scope='col'> Title </th>
            <th scope='col'> Datatype</th>
          </tr>
          <tbody>
            {% for m in current_mapping[c] %}
              <tr>
                <td> {{m.title}} </td>
                <td> {{m.datatype}} </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  {% endfor %}
  <br>


  {{ form.input('title', id='field-title', label=_('Attribute title'),
                value=title, error=errors.title, classes=['control-full'])
  }} 

  {{ form.select('datatype', id='field-datatype', label=_('Attribute datatype'),
                 options=available_datatypes, selected=datatype or available_datatypes[0],
                 error=errors.available_datatypes, classes='control-large') 
  }}

  {{ form.textarea('description', id='field-description', value=description,
                   placeholder='Document your metadata attribute here', 
                   label=_('Attribute documentation'), error=errors.description, 
                   classes='control-large') 
  }} 
  
{% endblock %} 
