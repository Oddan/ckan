{% ckan_extends %}


{% block basic_fields_format %}
  {# ------------------- Same as parent, except changed label ------------------- #}
  {% set format_attrs = {'data-module': 'autocomplete', 'data-module-source': '/api/2/util/resource/format_autocomplete?incomplete=?'} %}
  {% call form.input('format', id='field-format', label=_('Download storage format'), placeholder=_('eg. CSV, XML or JSON'), value=data.format, error=errors.format, classes=['control-medium'], attrs=format_attrs) %}
    <span class="info-block info-block-small">
      <i class="fa fa-info-circle"></i>
      {{ _('This will be guessed automatically. Leave blank if you wish') }}
    </span>
  {% endcall %}
  
{% endblock %}

{% block metadata_fields %}
  {% set resource_classes = h.resource_categories() %}
  {% set category_metadata = h.resource_category_items() %}


  {# ======================= Input purpose and assumptions ======================= #}
    <i class="fa fa-info-circle"></i>
    <i>Explain the main purpose or intended use for which the data was prepared</i>
    {{ form.markdown('purpose', id='field-purpose', label=_('Purpose'),
                      value = data.purpose,
                      placeholder = 'Main purpose or intended use',
                      error=errors.purpose,
                      classes=['control-large']) }}
    
    <i class="fa fa-info-circle"></i>
    <i>Explain any important assumptions to be aware of when using the data</i>
    {{ form.markdown('assumptions', id='field-assumptions', label=_('Assumptions'),
                  value = data.assumptions,
                  placeholder = 'List assumptions here',
                  error=errors.assumptions,
                  classes=['control-large']) }}
    
  {# =============================== Input sources ============================== #}
  <i class="fa fa-info-circle"></i>
  <i>
    Input a list of (data) sources that went into producing this data component.
    List each source on a separate line, on the form &lt;name&gt;, &lt;uri&gt;
  </i>
  {{form.textarea('sources', id='field-sources', label=_('Data sources'),
                  value=data.sources,
                  placeholder=
                  '<source 1 name> , <source 1 URI>\n<source 2 name> , <source 2 URI>',
                  error=errors.sources, classes=['control-large']) }}           
  
  {# ============================= Input data format ============================= #}

  {% set formats = h.dataformatlist() %}
  
  <div class="col-md-6">  
    {{ form.select('dataformat', id='field-dataformat', label=_('Data format'),  
                   options=formats, selected=data.dataformat or formats[0],  
                   error=errors.dataformat, classes=['control-large']) }}  
  </div>  

  <div style="clear: both;"></div>
  {# ============================== Input category ============================== #}
  <i class="fa fa-info-circle"></i>
  <i>Choose as specific as possible.  For an overview of the classifcation,
    click <a href="{{ h.url_for('cdsmetadata.resource_categories') }}" target="_blank">here</a>.
  </i>

  <div>
  {{ form.select('category', id='field-category', label=_('Resource category'),
                 options=resource_classes, 
                 selected=data.category or resource_classes[0].value,
                 error=errors.category,
                 attrs={'onchange': "activate_relevant_input()", 'class': 'form-control'},
                 classes=['control-large']) }}
  </div>

  {# ------------------------------ Category items ------------------------------ #}

  
  {% for md in category_metadata %}
    <div class='category-metadata'>
      <i class="fa fa-info-circle"></i>
      <i>{{md[3]}}</i>
      {% if md[2] == "ENUM" %}
        {{form.select(md[1].lower(), id='field-' + md[1].lower(), label=_(md[1]),
                      options=md[4],
                      selected=md[4][0],
                      attrs={'code': md[0], 'class': 'form-control'},
                      classes=['control-medium']) }}
      {% else %} 
        {{form.input(md[1].lower(), id='field-' + md[1].lower(), label=_(md[1]),
                     attrs={'code': md[0], 'class': 'form-control'},
                     classes=['control-medium']) }}
      {% endif %}
    </div>
  {% endfor %}
  
{% endblock %}
