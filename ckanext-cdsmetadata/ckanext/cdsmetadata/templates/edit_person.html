{% extends "edit_metadata.html" %}
{% set first_name = g.cur_item['first_name'] or "" %}
{% set last_name = g.cur_item['last_name'] or "" %}
{% set email = g.cur_item['email'] or "" %}
{% set affiliations = g.cur_item['affiliation'] or [] %}
{% set orglist_aff = g.extra['orglist_aff'] %}

{# {% set num_affiliations = affiliations | length %} #}
{# {% set first_affiliation = "<none>" %} #}
{# {% if num_affiliations > 0 %} #}
{#   {% set first_affiliation = affiliations[0] %} #}
{# {% endif %}  #}

{% block dataformat_subheading %}
  <h2>Edit Person</h2>
{% endblock %} 

{% block metadata_form_fields %}
  
  {{ form.input('first_name', id='field-first_name', label=_('First name'),
     value=first_name, error=errors.first_name, classes=['control-full']) }} 

  {{ form.input('last_name', id='field-last_name', label=_('Last name'),
     value=last_name, error=errors.last_name, classes=['control-full'], is_required=true) }} 
  
  {{ form.input('email', label=_('Email'), id='field-email', type='email', value=email,
     error=errors.email, placeholder=_('eg. joe@example.com'), classes=['control-medium'],
     is_required=true) }}

  <div onclick="var selector = document.getElementById('affiliation');
                var selected = Array.prototype.filter.apply( 
                selector.options, [ function(o) { return o.selected;}]); 
                var aflist = document.getElementById('affiliation-list');
                while(aflist.firstChild) {
                  aflist.removeChild(aflist.firstChild);
                }
                var item, content; 
                for (var i = 0; i < selected.length; i++) { 
                  item = document.createElement('li'); 
                  content = document.createTextNode(selected[i].text); 
                  item.appendChild(content); 
                  aflist.appendChild(item); 
              }">
       <i>(hold down CTRL for multiselect)</i>
    {{ formext.multiselect('affiliation', 
                           label=_('Update Affiliation(s)'), 
                           error=errors.affiliation, 
                           classes='control-large', 
                           attrs={'multiple': 'true', 'style': 'width: 100%', 'selected':1}, 
                           options=orglist_aff) }}
  </div>
  <b>Currently chosen affiliations</b> 
  {# list previous affiliations #}
  <div id="affiliation-list">
    {% for aff in affiliations %}
      <li> {{ aff[1] }} </li>
    {% endfor %} 
  </div>  


  <b>Contact person for (organization)</b>
  <br>
  <b>Contact person for (dataset)</b>
  <br>
  <b>Contributor to (dataset)</b>
  <br>
              
{% endblock %} 

              
