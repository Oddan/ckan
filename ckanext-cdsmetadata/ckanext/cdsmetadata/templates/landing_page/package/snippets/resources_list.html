{# 
Renders a list of resources with icons and view links.

resources - A list of resources to render
pkg - A package object that the resources belong to.

Example:

  {% snippet "package/snippets/resources_list.html", pkg=pkg, resources=pkg.resources %}

#}


{# This file creates the checkbox form to select multiple resources for download #}

{# Check the presence of any externally stored dataset components #}

{% set foundExternal = {'flag': False} %}

{% if resources %}
  {% for resource in resources %}
    {% if not resource.url_type %}
      {% if foundExternal.update({'flag': True})%}{% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

<section id="dataset-resources" class="resources">
  <h3>{{ _('Download dataset parts') }}</h3>
  {# {% if c.size_error_occured %} #}
  {#   <div id="size_warning_message"> #}
  {#     <p class="text-warning"> #}
  {#       <i class="fa fa-warning"></i> #}
  {#       Error: Combined sizpe of multiple download items must not exceed {{c.zipfile_size_limit}}.  Please #}
  {#       reduce the number of selected items and try again, or download the desired #}
  {#       items individually. #}
  {#     </p> #}
  {#   </div> #}
  {# {% endif %} #}
  {% if foundExternal.flag %}
    <p><em>NB: Dataset parts without adjacent checkboxes are stored outside the
  portal and must be downloaded separately.  Click on an item to download
  directly from its informational page.</em></p>  {% endif %}
    <br>
    {% block resource_list %}
      {% if resources %}
        {% if h.check_access('resource_show', {'id': resources[0]['id']}) %}
          <ul class="{% block resource_list_class %}resource-list{% endblock %}">
            {% block resource_list_inner %}
              {% set can_edit = h.check_access('package_update', {'id':pkg.id }) %}
              <form action="/screen_download_request" method="POST">
                
                {% for resource in resources %}
                  <div style="white-space: nowrap;">  
                    {# <input  type="checkbox" #}
                    {#         name="{{Â resource.name }}" #}
                    {#         value="{{ resource.id }}" #}
                    {#         id="resource" #}
                    {#         {% if not resource.url_type == "upload" %} #}
                    {#           disabled #}
                    {#         {% endif %} #}
                    {#         > #}
                    <div style="display: inline-block; white-space: normal;">
                      {% snippet 'package/snippets/resource_item.html', pkg=pkg, res=resource, can_edit=can_edit %}
                    </div>
                    <br> 
                  </div>
                {% endfor %}
                <br>
                {% set license = h.get_license(pkg.cdslicense) %}
                <input type="checkbox" required>
                By clicking this I confirm that I have read and accepted this dataset's
                {% if license %}
                  <a target=_blank href="{{ h.url_for('cdsmetadata.view_license', id=license.id) }}" rel="dc:rights">
                    licence requirements.
                  </a>
                {% else %}
                  license requirements.
                {% endif %}
                <br>
                <br>
                <div style="text-align: center;">
                  <input type="button" value="Select all" onclick="select_all_resources(this)"
                         style="width:150px;">
                         <br><br>
                         <input type="submit" value="Download selected" style="width:150px;"]>
                </div>
              </form>
            {% endblock %}
          </ul>
        {% else %}
          <p class="empty"> Log in with authorized user in order to access and download dataset components.</p>
        {% endif %}
      {% else %}
        {% if h.check_access('resource_create', {'package_id': pkg['id']}) %}
            {% trans url=h.url_for(controller='package', action='new_resource', id=pkg.name) %}
              <p class="empty">This dataset has no data, <a href="{{ url }}">why not add some?</a></p>
            {% endtrans %}
        {% else %}
            <p class="empty">{{ _('This dataset has no data') }}</p>
        {% endif %}
      {% endif %}
    {% endblock %}
</section>

